<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Fantasy Fight Picks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Stop mobile from serving stale files -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root {
      color-scheme: dark;
      --bg: #0f1115;
      --panel: #151923;
      --muted: #9aa3b2;
      --text: #e6edf3;
      --accent: #4aa3ff;
      --border: #222a36;
      --pill: #1b2230;
      --ok: #22c55e;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:20px auto 80px;padding:0 14px}
    header{display:flex;gap:10px;align-items:center;margin-bottom:12px}
    h1{margin:0;font-size:20px}
    #appStatus{margin-left:auto;color:var(--muted);font-size:13px}

    .bar,.section{background:var(--panel);border:1px solid var(--border);border-radius:12px}
    .bar{padding:10px}
    .section{padding:14px;margin-top:14px}
    .section h2{margin:0 0 10px;font-size:18px}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .pill{background:var(--pill);border:1px solid var(--border);border-radius:999px;color:var(--text);padding:10px 12px;width:100%;outline:0}

    .list{display:grid;gap:10px}
    .fight{background:#121722;border:1px solid var(--border);border-radius:10px;padding:10px}
    .line{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px}
    .vs{color:var(--muted);font-size:12px}
    .muted{color:var(--muted)}
    .right{text-align:right}

    select{background:var(--pill);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:8px 10px;width:100%}
    button{appearance:none;border:1px solid var(--border);border-radius:10px;padding:10px 14px;background:#172033;color:var(--text);cursor:pointer;font-weight:600}
    button.primary{background:var(--accent);border-color:#3a92ea;color:#000}
    button:disabled{opacity:.6;cursor:not-allowed}

    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
    th{color:var(--muted);font-weight:600}
    .center{text-align:center}.right{text-align:right}

    #champBanner{margin:0 0 10px;font-weight:700;color:#ffd166}
    footer{margin-top:26px;color:var(--muted);font-size:12px;text-align:center}
    .badge{display:inline-block;padding:.2rem .5rem;border:1px solid var(--border);border-radius:999px;background:#131b28;color:var(--text);font-size:12px}
  </style>

  <script>
    // API base (can be overridden once with ?api=... and persisted)
    window.API_BASE = "https://fantasy-fight-picks-json.onrender.com/api";
    (function () {
      try {
        const qp = new URLSearchParams(location.search);
        const param = qp.get("api");
        if (param) localStorage.setItem("API_BASE", param);
        const saved = localStorage.getItem("API_BASE");
        if (saved) window.API_BASE = saved;
      } catch (_) {}
    })();

    // Hard-unregister any old service worker so phones stop using stale assets
    (function () {
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.getRegistrations?.().then(rs => rs.forEach(r => r.unregister())).catch(()=>{});
      }
      if (window.caches && caches.keys) {
        caches.keys().then(keys => keys.forEach(k => caches.delete(k))).catch(()=>{});
      }
    })();
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Fantasy Fight Picks</h1>
      <div id="appStatus" class="muted">loading…</div>
    </header>

    <div id="champBanner" class="bar" role="status"></div>

    <div class="bar">
      <div class="row">
        <input id="search" class="pill" type="text" placeholder="Search fights or fighters…" />
        <input id="username" class="pill" type="text" placeholder="Your username (for picks)" />
      </div>
    </div>

    <section class="section">
      <h2>Card</h2>
      <div id="fights" class="list" aria-live="polite"></div>
      <div style="display:flex;gap:10px;margin-top:12px;">
        <button id="submitBtn" class="primary">Submit Picks</button>
        <button id="loadPicksBtn">Load My Picks</button>
      </div>
      <div id="submitMsg" class="muted" style="margin-top:8px;"></div>
    </section>

    <section class="section">
      <h2>Live Leaderboard</h2>
      <div id="leaderboardNote" class="muted" style="margin-bottom:8px;"></div>
      <table>
        <thead><tr><th>User</th><th class="right">Points</th></tr></thead>
        <tbody id="leaderboardBody"></tbody>
      </table>
    </section>

    <section class="section">
      <h2>Results (as fights conclude)</h2>
      <table>
        <thead>
          <tr><th>Fight</th><th>Winner</th><th>Method</th><th class="center">Round</th><th class="center">Underdog?</th></tr>
        </thead>
        <tbody id="resultsBody"></tbody>
      </table>
    </section>

    <footer>API: <span id="apiBaseText" class="muted"></span></footer>
  </div>

  <script src="script.js" defer></script>
</body>
</html>
